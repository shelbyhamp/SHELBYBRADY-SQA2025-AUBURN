#!/bin/bash

echo "Scanning all Python files in the repo (excluding non-Python files)..."

# Find all .py files (excluding hidden and irrelevant dirs)
PY_FILES=$(find . -type f -name "*.py" \
  -not -path "./.venv/*" \
  -not -path "./__pycache__/*" \
  -not -path "./integration-test-results/*" \
  -not -path "./.git/*")

if [[ -z "$PY_FILES" ]]; then
  echo "No Python files found. Skipping Bandit scan."
  exit 0
fi

mkdir -p integration-test-results
bandit -f csv -o integration-test-results/bandit_report.csv $PY_FILES

echo "Bandit scan complete."
exit 0
